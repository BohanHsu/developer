package http_test;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.CookieHandler;
import java.net.HttpURLConnection;
import java.net.URL;
import java.net.URLConnection;
import java.util.HashMap;
import java.util.LinkedList;
import java.util.List;

public class HttpTest {
	List<String> cookies = new LinkedList<String>();
	HttpURLConnection conn = null;
	private final String USER_AGENT = "Mozilla/5.0";

	public String getPageContent(String url) throws IOException {
		String content = null;
		URL urlObj = new URL(url);
		conn = (HttpURLConnection) urlObj.openConnection();
		conn.setRequestMethod("GET");
		conn.setUseCaches(false);
		conn.setRequestProperty("User-Agent", USER_AGENT);
		conn.setRequestProperty("Accept",
				"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8");
		conn.setRequestProperty("Accept-Language", "en-US,en;q=0.8");

		// add cookies

		int responseCode = conn.getResponseCode();
		String inputLine = null;
		BufferedReader br = new BufferedReader(new InputStreamReader(
				conn.getInputStream()));
		StringBuffer sb = new StringBuffer();

		while ((inputLine = br.readLine()) != null) {
			sb.append(inputLine);
		}
		br.close();
		setCookies(conn.getHeaderFields().get("Set-Cookie"));
		content = sb.toString();
		return content;
	}

	public void setCookies(List<String> cookies) {
		this.cookies = cookies;
	}
	
	public String getUuid(String html){
		String key = "document.cplogin.uuid.value=";
		int index = html.indexOf(key);
		System.out.println(index);
		String uuid = html.substring(index+1+key.length(),index+37+key.length());
		return uuid;
	}
	
	/*
	cplogin.user.value=document.userid.user.value;
    document.cplogin.uuid.value="4a3be495-9baf-43d2-aee2-3197f3b5b43e";
    action = "https://myneu.neu.edu/cp/home/login"
    user:
    uuid:
    pass:
	*/
	
	public String getPostForm(String uuid, String username, String password){
		HashMap<String, String> form = new HashMap<String,String>();
		form.put("user", username);
		form.put("pass", password);
		form.put("uuid", uuid);
		
		for (iterable_type iterable_element : form.keySet()) {
			
		}
	}
	
	// test 
	public static void main(String[] args) throws IOException {
		HttpTest ht = new HttpTest();
		String url = "http://myneu.neu.edu/cp/home/displaylogin";
		String returnPage = ht.getPageContent(url);
		System.out.println(returnPage);
		
		for (String string : ht.cookies) {
			System.out.println(string);
		}
		
		String uuid = ht.getUuid(returnPage);
		System.out.println(uuid);
	}
}
